<link rel="import" href="../sib-base.html">
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.2/fullcalendar.min.js'></script>

<script>
(function(){
    class SIBCalendar extends SIBListMixin(SIBBase) {
        get extra_context() {return {date: "http://www.w3.org/2001/XMLSchema#dateTime"}}
        constructor() {
            super();
            this.attachShadow({mode: 'open'});
            const style = document.createElement('style');
            style.innerHTML = '@import url("https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.2/fullcalendar.min.css");';
            this.shadowRoot.appendChild(style);
            const div = document.createElement('div');
            div.style = "max-width: 100%; max-height: 100%";
            this.shadowRoot.appendChild(div);
        }
        
        dispatchSelect(event) {
            const resource = event.resource;
            this.dispatchEvent(new CustomEvent('resourceSelect', {detail: {resource: resource}}));
            if(this.next) window.dispatchEvent(new CustomEvent('navigate', {detail: {route: this.next, resource: resource}}));
        }
        appendChildElt(resource) {
            if(resource.name && resource.date)
                this.events.push({title: resource.name, start: resource.date, resource: resource});
        }
        empty() {
            this.events = [];
        }
        populate() {
            super.populate();
            $(this.shadowRoot.lastChild).fullCalendar({events: this.events, height: this.style.height, eventClick: this.dispatchSelect.bind(this)});
        }
    }
    customElements.define('sib-calendar', SIBCalendar);
}());
</script>

<link rel="import" href="./ldp-base.html">
<link rel="import" href="./ldp-widgets.html">

<script>
(function(){
    class LDPDisplay extends LDPBase {
        constructor(){
            super();
            this.defaultWidget = 'ldp-display-div';
        }
        
        get childTag() {
            return this.dataset.child || this.tagName;
        }
        dispatchSelect(event) {
            const resource = event.target.closest(this.childTag).resource;
            this.dispatchEvent(new CustomEvent('select', {detail: {resource: resource}}));
        }
        filterList(filters) {
            this.filters = filters;
        }
        appendFilters() {
            const formElt = document.createElement('ldp-form');
            formElt.resource = this.resource;
            formElt.save = this.filterList.bind(this);
            this.appendChild(formElt);
        }
        appendChildTag(resource) {
            const child = document.createElement(this.childTag);
            child.resource = resource;
            child.addEventListener('click', this.dispatchSelect.bind(this));
            child.dataset.fields = this.dataset.fields;
            
            for (let attr of this.attributes) //copy widget and value attributes
                if(attr.name.startsWith('value-') || attr.name.startsWith('set-') || attr.name.startsWith('widget-'))
                    child.setAttribute(attr.name, attr.value);
            
            this.appendChild(child);
        }
        populate() {
            if(this.isContainer) {
                this.empty();
                this.appendFilters();
                for(let item of this.resources) this.appendChildTag(item);
            }
            
            else {
                this.empty();
                for(let field of this.fields) this.appendWidget(field);
            }
        }
    }
    customElements.define('ldp-display', LDPDisplay);
}());
</script>

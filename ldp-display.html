<link rel="import" href="./ldp-base.html">
<link rel="import" href="./ldp-widgets.html">

<script>
(function(){
    class LDPDisplay extends LDPBase {
        constructor(){
            super();
            this.defaultWidget = 'ldp-display-div';
        }
        
        childTag() {
            return this.dataset.child || this.tagName;
        }
        dispatchSelect(event) {
            var resource = event.target.closest(this.childTag()).resource;
            this.dispatchEvent(new CustomEvent('select', {detail: {resource: resource}}));
        }
        appendChildTag(resource) {
            var child = document.createElement(this.childTag());
            child.resource = resource;
            child.addEventListener('click', this.dispatchSelect.bind(this));
            child.dataset.fields = this.dataset.fields;
            child.dataset.widgets = this.dataset.widgets;
            this.appendChild(child);
        }
        populate() {
            if(this.isContainer()) {
                this.removeChildren();
                
                for(let item of this.listResources(this.resource))
                    this.appendChildTag(item);
            }
            
            else {
                this.removeChildren();
                for(let field of this.getFields(this.resource))
                    this.appendFieldWidget(field);
            }
        }
    }
    customElements.define('ldp-display', LDPDisplay);
}());
</script>

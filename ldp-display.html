<link rel="import" href="./ldp-base.html">
<link rel="import" href="./ldp-widgets.html">

<script>
(function(){
    class LDPDisplay extends LDPListMixin(LDPWidgetMixin(LDPBase)) {
        get defaultWidget() {return 'ldp-display-div';}
        
        get childTag() {
            return this.dataset.child || this.tagName;
        }

        // Here "even.target" points to the content of the widgets of the children of ldp-display
        dispatchSelect(event) {
            const resource = event.target.closest(this.childTag).resource;
            this.dispatchEvent(new CustomEvent('select', {detail: {resource: resource}}));
            if(this.next) window.dispatchEvent(new CustomEvent('navigate', {detail: {route: this.next, resource: resource}}));
        }
        appendChildElt(resource) {
            const child = document.createElement(this.childTag);
            child.resource = resource;
            child.addEventListener('click', this.dispatchSelect.bind(this));
            if(this.dataset.fields) child.dataset.fields = this.dataset.fields;
            
            for (let attr of this.attributes) //copy widget and value attributes
                if(attr.name.startsWith('value-') || attr.name.startsWith('set-') || attr.name.startsWith('widget-'))
                    child.setAttribute(attr.name, attr.value);
            
            this.appendChild(child);
        }
        appendSingleElt() {
            for(let field of this.fields) this.appendWidget(field);
        }
    }
    customElements.define('ldp-display', LDPDisplay);
}());
</script>

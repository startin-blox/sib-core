<link rel="import" href="./ldp-base.html">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
    integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>
<script>
(function(){
    class LDPMap extends LDPListMixin(LDPBase) {
        constructor() {
            super();
            this.markers = [];
            this.attachShadow({mode: 'open'});
            const div = document.createElement('div');
            div.style = "width: 100%; height: 100%";
            this.map = L.map(div);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}').addTo(this.map);
            this.shadowRoot.appendChild(div);
        }
        
        dispatchSelect(event) {
            const resource = event.target.options.resource;
            this.dispatchEvent(new CustomEvent('select', {detail: {resource: resource}}));
        }
        appendChildElt(resource) {
            if(resource.lat && resource.lng) {
                const marker = L.marker([resource.lat, resource.lng], {resource: resource});
                marker.addTo(this.map).on('click', this.dispatchSelect.bind(this));
                this.markers.push(marker);
            }
        }
        populate() {
            super.populate();
            this.map.fitBounds(L.featureGroup(this.markers).getBounds());
        }
    }
    customElements.define('ldp-map', LDPMap);
}());

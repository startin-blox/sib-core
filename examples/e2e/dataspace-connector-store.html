<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataspaceConnector Store Test</title>
</head>
<body>
    <div id="status">Loading...</div>

    <script type="module">
        (async () => {
            try {
                console.log('üîÑ Starting store initialization...');

                // Import StoreService from store.js which exports it
                const storeModule = await import('../../dist/store.js');
                console.log('‚úÖ Store module imported:', Object.keys(storeModule));

                const { StoreService } = storeModule;

                if (!StoreService) {
                    throw new Error('StoreService not found in module exports');
                }

                // Force reset of StoreService to allow reinitialization
                StoreService.currentStore = null;
                StoreService.currentConfig = null;

                // Configure DataspaceConnector store
                const config = {
                    type: 'dataspaceConnector',
                    endpoint: 'https://test-connector.example.com/management/',
                    catalogEndpoint: 'https://test-connector.example.com/management/v3/catalog/request',
                    contractNegotiationEndpoint: 'https://test-connector.example.com/management/v3/contractnegotiations',
                    transferProcessEndpoint: 'https://test-connector.example.com/management/v3/transferprocesses',
                    authMethod: 'edc-api-key',
                    edcApiKey: 'test-api-key',
                    participantId: 'test-consumer',
                    retryAttempts: 5,
                    timeout: 30000
                };

                console.log('üîß Initializing EDC store with config:', config);

                // Initialize a new DataspaceConnector store
                StoreService.init(config);
                const storeInstance = StoreService.getInstance();

                console.log('‚úÖ Store instance created:', storeInstance);

                // Set on window immediately
                window.edcStore = storeInstance;

                console.log('‚úÖ window.edcStore set:', window.edcStore);

                // Update status
                document.getElementById('status').textContent = 'Store initialized successfully';
                console.log('‚úÖ DataspaceConnector store available as window.edcStore');

            } catch (error) {
                const errorMsg = 'Error: ' + error.message;
                console.error('‚ùå Store initialization error:', error);
                console.error('Error stack:', error.stack);

                // Update status
                document.getElementById('status').textContent = errorMsg;

                // Also make the error details available on window for debugging
                window.storeError = error;
            }
        })();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DFC hasType Bug Reproduction</title>
    <script type="module" src="../../src/index.ts"></script>
</head>
<body>
    <h1>DFC hasType Bug Reproduction</h1>

    <p>This example reproduces a bug where accessing <code>dfc-b:hasType</code> through <code>sibStore.getData()</code> returns null instead of the expected URL string.</p>

    <h2>Expected Behavior:</h2>
    <p>Should return: <code>"https://github.com/datafoodconsortium/taxonomies/releases/latest/download/productTypes.rdf#butternut"</code></p>

    <h2>Bug Test Results:</h2>
    <div id="test-results">
        <p>Loading...</p>
    </div>

    <script type="module">
        import { store } from '../../src/store.ts';

        async function testBug() {
            const resultsDiv = document.getElementById('test-results');
            try {
                // Load the enterprise data
                const enterpriseUrl = 'https://api.proxy-stg.cqcm.startinblox.com/enterprises/2/';
                
                console.log('Loading enterprise data from:', enterpriseUrl);
                const enterpriseData = await store.getData(enterpriseUrl, {});

                console.log('Enterprise data loaded:', enterpriseData, enterpriseData['@id']);

                const enterpriseName = await enterpriseData['dfc-b:name'];
                console.log('Enterprise name:', enterpriseName);

                // Get the supplies data
                const suppliesData = await enterpriseData['dfc-b:supplies'];
                console.log('Supplies data:', suppliesData, suppliesData["@id"]);

                // Try to get the first supplied product
                const firstProduct = (await store.getData(suppliesData["@id"]))["ldp:contains"][0];
                console.log('First product:', firstProduct);

                if (firstProduct) {
                    // Test the bug: accessing dfc-b:hasType
                    const hasType = await firstProduct['dfc-b:hasType'];

                    let bugStatus;
                    const expectedValue = "https://github.com/datafoodconsortium/taxonomies/releases/latest/download/productTypes.rdf#butternut";

                    if (hasType === null) {
                        bugStatus = '❌ BUG CONFIRMED: dfc-b:hasType returns null';
                    } else if (hasType === expectedValue) {
                        bugStatus = '✅ Working correctly: dfc-b:hasType returns expected URL';
                    } else {
                        bugStatus = `⚠️ Unexpected value: dfc-b:hasType returns "${hasType}" (type: ${typeof hasType})`;
                    }

                    resultsDiv.innerHTML = `
                        <p><strong>Bug Status:</strong> ${bugStatus}</p>
                        <p><strong>Actual value:</strong> <code>${JSON.stringify(hasType)}</code></p>
                        <p><strong>Expected value:</strong> <code>${expectedValue}</code></p>
                        <p><strong>Value type:</strong> <code>${typeof hasType}</code></p>
                    `;
                } else {
                    resultsDiv.innerHTML = '<p>❌ ERROR: No products found in supplies</p>';
                }
                
            } catch (error) {
                console.error('Error testing bug:', error);
                resultsDiv.innerHTML = `<p>❌ ERROR: ${error.message}</p>`;
                resultsDiv.innerHTML += `<p>Error details: ${error.stack}</p>`;
            }
        }

        // Run the test when the page loads
        document.addEventListener('DOMContentLoaded', testBug);
    </script>
</body>
</html>
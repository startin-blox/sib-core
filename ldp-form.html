<link rel="import" href="./ldp-base.html">
<link rel="import" href="./ldp-widgets.html">

<dom-module id="ldp-form">
    <template>
        <style include="custom-styles"></style>
        <form on-submit="saveForm">
            <ldp-list-fields resource="{{resource}}" fields="{{fields}}" widgets="{{widgets}}" default-widget="ldp-form-text"></ldp-list-fields>
            <input type="submit">
        </form>
    </template>

    <script>
    (function(){
        class LDPForm extends LDPBase {
            static get is() { return 'ldp-form'; }
            
            formToObject(form) {
                return [].reduce.call(form.elements, function(data, element) {
                    if(element.name) data[element.name] = element.value;
                    return data;
                }, {})
            }
            saveForm(event) {
                var resource = this.formToObject(event.target);
                if(!this.isContainer(this.resource)) resource['@id'] = this.resource['@id'];
                store.save(resource, this.resource['@id']).then(function(){
                    this.dispatchEvent(new CustomEvent('save', {detail: {resource: resource}}));
                }.bind(this));
                event.preventDefault();
                return false;
            }
        }
        
        customElements.define(LDPForm.is, LDPForm);
    }());
    </script>
</dom-module>

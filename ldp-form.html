<link rel="import" href="./ldp-base.html">
<link rel="import" href="./ldp-widgets.html">

<script>
(function(){
    class LDPForm extends LDPBase {
        constructor(){
            super();
            this.defaultWidget = 'ldp-form-text';
        }
        
        formToObject(form) {
            return [].reduce.call(form.elements, function(data, element) {
                if(element.name) data[element.name] = element.value;
                return data;
            }, {})
        }
        save(resource) {
            store.save(resource, this.resource['@id']).then(
                () => this.dispatchEvent(new CustomEvent('save', {detail: {resource: resource}}))
            );
        }
        submitForm(event) {
            const resource = this.formToObject(event.target);
            if(!this.isContainer) resource['@id'] = this.resource['@id'];
            this.save(resource);
            event.preventDefault();
            return false;
        }
        populate() {
            this.empty();

            const form = document.createElement('form');
            form.addEventListener('submit', this.submitForm.bind(this));
            this.appendChild(form);
            
            for(let field of this.fields)
                this.appendWidget(field, form);
            
            const submit = document.createElement('input');
            submit.type = 'submit';
            form.appendChild(submit);
        }
    }
    
    customElements.define('ldp-form', LDPForm);
}());
</script>

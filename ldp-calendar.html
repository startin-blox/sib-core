<link rel="import" href="./ldp-base.html">
<link rel="import" href="./ldp-widgets.html">
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.2/fullcalendar.min.css' />
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.2/fullcalendar.min.js'></script>

<script>
(function(){
    class LDPCalendar extends LDPBase {
        constructor() {
            super();
            this.attachShadow({mode: 'open'});
            const div = document.createElement('div');
            div.style = "max-width: 100%; max-height: 100%";
            this.shadowRoot.appendChild(div);
        }
        
        dispatchSelect(event) {
            const resource = event.target.closest(this.childTag).resource;
            this.dispatchEvent(new CustomEvent('select', {detail: {resource: resource}}));
        }
        toEvent(resource) {
            return {title: resource.name, start: resource.deadline}
        }
        populate() {
            this.events = [];
            if(this.isContainer) 
                for(let resource of this.resources) this.events.push(this.toEvent(resource));
            
            else
                this.events.push(this.toEvent(this.resource));
            $(this.shadowRoot.firstChild).fullCalendar({events: this.events, height: this.style.height});
        }
    }
    customElements.define('ldp-calendar', LDPCalendar);
}());
</script>
